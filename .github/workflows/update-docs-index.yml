#!/bin/bash

# ê³ ê¸‰ ë¬¸ì„œ ì¸ë±ìŠ¤ ìƒì„± ìŠ¤í¬ë¦½íŠ¸

INDEX_FILE="README.md"

echo "## ðŸ“š Documentation" > $INDEX_FILE
echo "" >> $INDEX_FILE

# ì¹´í…Œê³ ë¦¬ë³„ ë§¤í•‘ ì •ì˜
declare -A categories=(
    ["setup"]="ðŸš€ Setup & Installation"
    ["api"]="ðŸ“– API Reference"
    ["guides"]="ðŸ“š Guides"
    ["tutorials"]="ðŸŽ“ Tutorials"
    ["advanced"]="ðŸ”§ Advanced"
    ["contributing"]="ðŸ¤ Contributing"
)

# ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì²˜ë¦¬
for category in "${!categories[@]}"; do
    category_path="docs/$category"
    
    if [ -d "$category_path" ]; then
        echo "### ${categories[$category]}" >> $INDEX_FILE
        echo "" >> $INDEX_FILE
        
        find "$category_path" -name "*.md" -type f | sort | while read file; do
            # íŒŒì¼ì—ì„œ ì œëª©ê³¼ ì„¤ëª… ì¶”ì¶œ
            title=$(head -20 "$file" | grep -m 1 "^# " | sed 's/^# //')
            description=$(head -50 "$file" | grep -m 1 "^>" | sed 's/^> //')
            
            if [ -z "$title" ]; then
                title=$(basename "$file" .md)
            fi
            
            if [ -n "$description" ]; then
                echo "- [$title](./$file) - $description" >> $INDEX_FILE
            else
                echo "- [$title](./$file)" >> $INDEX_FILE
            fi
        done
        echo "" >> $INDEX_FILE
    fi
done

# ìµœê·¼ ìˆ˜ì •ëœ ë¬¸ì„œ ì„¹ì…˜ ì¶”ê°€
echo "### ðŸ“ Recently Updated" >> $INDEX_FILE
echo "" >> $INDEX_FILE

find docs -name "*.md" -type f -printf '%T@ %p\n' | sort -rn | head -5 | while read timestamp file; do
    title=$(head -20 "$file" | grep -m 1 "^# " | sed 's/^# //' || basename "$file" .md)
    if [ -z "$title" ]; then
        title=$(basename "$file" .md)
    fi
    
    # ìˆ˜ì • ë‚ ì§œ í¬ë§·íŒ…
    date=$(date -d "@${timestamp%.*}" "+%Y-%m-%d")
    echo "- [$title](./$file) *(updated: $date)*" >> $INDEX_FILE
done

echo "" >> $INDEX_FILE

# í†µê³„ ì •ë³´ ì¶”ê°€
total_docs=$(find docs -name "*.md" -type f | wc -l)
echo "---" >> $INDEX_FILE
echo "*Total documents: $total_docs*" >> $INDEX_FILE